define(["text!sulusalescore/components/editable-data-row/templates/address.form.html"],function(a){"use strict";var b={instanceName:"undefined",fields:null,defaultProperty:null,overlayTemplate:null,overlayTitle:"",selectSelector:"#address-select"},c={rowClass:"editable-row",rowClassSelector:".editable-row",overlayTitle:"salesorder.orders.addressOverlayTitle",formSelector:".editable-data-overlay-form"},d={rowTemplate:function(a,b){return b?['<span class="block ',c.rowClass,' disabled">',a,"</span>"].join(""):['<span class="block pointer ',c.rowClass,'">',a,"</span>"].join("")}},e="sulu.editable-data-row.address-view.",f=function(){this.sandbox.emit(e+this.options.instanceName+".initialized")},g=function(a){this.sandbox.emit(e+this.options.instanceName+".changed",a)},h=function(){this.context.options.disabled||(this.sandbox.on("husky.overlay."+this.context.options.instanceName+".opened",function(){this.openedDialog||k.call(this),this.openedDialog=!1}.bind(this)),this.sandbox.on("husky.overlay."+this.context.options.instanceName+".initialized",function(){this.openedDialog=!1}.bind(this)),this.sandbox.on("husky.select."+this.options.instanceName+".select.selected.item",function(a){var b=this.context.getDataByPropertyAndValue.call(this,"id",a);l.call(this,b)}.bind(this)))},i=function(){var a=this.sandbox.form.getData(c.formSelector);this.sandbox.emit("husky.overlay."+this.context.options.instanceName+".close"),this.sandbox.emit("sulu.overlay.show-warning","salesorder.orders.addressOverlayWarningTitle","salesorder.orders.addressOverlayWarningMessage",j.bind(this,!1,null),j.bind(this,!0,a)),this.openedDialog=!0},j=function(a,b){if(a){var c,d=q.call(this,b);c=d?this.sandbox.util.extend({},this.context.selectedData,b):null,this.context.setSelectedData(c),g.call(this,this.context.selectedData),o.call(this,this.context.selectedData)}else this.sandbox.emit("husky.overlay."+this.context.options.instanceName+".open")},k=function(){var a=this.sandbox.dom.find(c.formSelector,this.context.$el);this.sandbox.start(this.sandbox.dom.find(".editable-data-overlay-container",this.$el)),this.sandbox.form.create(a).initialized.then(function(){this.context.selectedData&&l.call(this,this.context.selectedData)}.bind(this))},l=function(a){this.sandbox.form.setData(c.formSelector,a).fail(function(a){this.sandbox.logger.error("An error occured when setting data!",a)}.bind(this))},m=function(){this.context.options.disabled||(this.sandbox.dom.on(this.context.$el,"click",p.bind(this),c.rowClassSelector),this.sandbox.dom.on(this.context.$el,"change",function(a){var b=this.sandbox.dom.val(a.currentTarget),c=this.context.getDataByPropertyAndValue.call(this,"id",b);l.call(this,c)}.bind(this),this.options.selectSelector))},n=function(a){return a&&"array"===this.sandbox.util.typeOf(a)?this.sandbox.util.foreach(a,function(a){a&&a.country&&a.country.name&&(a.country=a.country.name),a.fullAddress=q.call(this,a)}.bind(this)):(a&&a.country&&a.country.name&&(a.country=a.country.name),a.fullAddress=q.call(this,a)),a},o=function(a){var b,e,f;e=this.sandbox.dom.find(c.rowClassSelector,this.context.$el),this.sandbox.dom.remove(e),a&&(f=n.call(this,a),b=this.sandbox.dom.createElement(d.rowTemplate(f.fullAddress,this.context.options.disabled)),this.sandbox.dom.append(this.context.$el,b))},p=function(){this.sandbox.emit("sulu.editable-data-row."+this.options.instanceName+".overlay.initialize",{overlayTemplate:a,overlayTitle:c.overlayTitle,overlayOkCallback:i.bind(this),overlayCloseCallback:null,overlayData:n.call(this,this.context.data)})},q=function(a){var b=a.street?a.street:"",c=(a.zip+" "+a.city).trim();return b+=b.length&&a.number?" "+a.number:a.number,b+=b.length&&c?", "+c:c,b+=b.length&&a.country?", "+a.country:a.country};return{initialize:function(a,c){this.context=a,this.sandbox=this.context.sandbox,this.options=this.sandbox.util.extend({},b,c),this.openedDialog=!1,h.call(this),m.call(this),f.call(this)},render:function(){o.call(this,this.context.selectedData)},openOverlay:function(){p.call(this)}}});