define(["text!sulusalescore/components/item-quantity-table/item.form.html","text!sulusalescore/components/item-quantity-table/item.row.html","text!sulusalescore/components/item-quantity-table/item.row-head.html"],function(a,b,c){"use strict";var d={data:[],itemsData:[],processedQuantityValueName:"shippedItems",processedItems:null,canAddRemove:!1,showFinishedItems:!0,isEditable:!0,isNew:!1,headerTranslations:{}},e={formId:"#item-table-form",listClass:".item-table-list",productSearchClass:".product-search",rowIdPrefix:"item-table-row-",rowClass:".item-table-row",quantityRowClass:".item-quantity",quantityInput:".quantity-input input"},f={rowClass:null,rowNumber:null,rowId:"",id:null,item:{id:null,name:"",number:"",quantity:"",quantityUnit:"",price:"",discount:null,overallPrice:"",currency:"EUR",useProductsPrice:!1,tax:0},processedQuantity:null,quantity:null},g="sulu.item-table.",h=g+"changed",i=function(){var a,b,c={},d={rowClass:"header",name:this.sandbox.translate("salescore.item.product"),number:this.sandbox.translate("salescore.item.number"),quantity:this.sandbox.translate("salescore.item.order-quantity"),quantityInput:this.sandbox.translate("salescore.item.quantity"),quantityUnit:this.sandbox.translate("salescore.item.unit"),price:this.sandbox.translate("salescore.item.price"),discount:this.sandbox.translate("salescore.item.discount"),overallPrice:this.sandbox.translate("salescore.item.overall-value"),processedQuantity:this.sandbox.translate("salescore.item.processed-quantity")};for(a in this.options.headerTranslations)this.options.headerTranslations.hasOwnProperty(a)&&(c[a]=this.sandbox.translate(this.options.headerTranslations[a]));return b=this.sandbox.util.extend({},d,c)},j=function(){},k=function(){this.sandbox.dom.on(this.$el,"data-changed",function(a){var b=a.items||[];p.call(this,b)}.bind(this)),this.sandbox.dom.on(this.$el,"change",l.bind(this),e.quantityInput)},l=function(a){var b=m.call(this,a).id;this.items[b].quantity=this.sandbox.dom.val(a.target),s.call(this),this.sandbox.emit(h)},m=function(a){var b=this.sandbox.dom.closest(a.target,".item-table-row"),c=this.sandbox.dom.attr(b,"id");return{row:b,id:c}},n=function(a,c){var d,g,h,i=0;return c!==!1&&this.rowCount++,this.options.processedItems?(h=a.item.id,i=this.options.processedItems[h]||0):a.hasOwnProperty(this.options.processedQuantityValueName)&&(i=a[this.options.processedQuantityValueName]),!this.options.showFinishedItems&&0===a.quantity&&a.quantity-i<1?void 0:(d=this.sandbox.util.extend({},f,a,{rowId:e.rowIdPrefix+this.rowCount,rowNumber:this.rowCount,isEditable:this.options.isEditable,isNew:this.options.isNew,canAddRemove:this.options.canAddRemove,processedQuantity:i,numberFormat:this.sandbox.numberFormat}),d.maxQuantity=(parseFloat(d.item.quantity)-parseFloat(i)).toFixed(1),d.maxQuantity=d.maxQuantity%1===0?parseInt(d.maxQuantity):d.maxQuantity,d.formattedMaxQuantity=this.sandbox.numberFormat(d.maxQuantity,"d"),d.isNew&&(d.quantity=d.formattedMaxQuantity),g=this.sandbox.util.template(b,d),this.sandbox.dom.createElement(g))},o=function(a){var b=n.call(this,a);return this.sandbox.dom.append(this.$find(e.listClass),b),b},p=function(a){this.items={},this.sandbox.dom.empty(this.$find(e.listClass)),q.call(this,a)},q=function(a){var b,c,d,f,g,h;for(b=-1,c=a.length;++b<c;)d=a[b],f=o.call(this,d),g=this.sandbox.dom.attr(f,"id"),this.options.isNew&&(h=this.sandbox.dom.val(this.sandbox.dom.find(e.quantityInput,f)),d.quantity=h),this.items[g]=d;s.call(this)},r=function(){var a=this.sandbox.util.extend({canAddRemove:this.options.canAddRemove},f,i.call(this)),b=this.sandbox.util.template(c,a);this.sandbox.dom.append(this.$find(e.listClass),b)},s=function(){this.sandbox.dom.data(this.$el,"items",this.getItems())},t=function(a){var b,c;for(b in this.options.data)if(this.options.data.hasOwnProperty(b)&&(c=this.options.data[b].item,c.id===a))return this.options.data[b];return null},u=function(){var a,b,c,d=[];for(a in this.options.itemsData)this.options.itemsData.hasOwnProperty(a)&&(c=this.options.itemsData[a],b=t.call(this,c.id),b||(b=this.sandbox.util.extend({},f,{item:c})),d.push(b));return this.options.data=d,d},v=function(){this.sandbox.form.create(e.formId)};return{initialize:function(){var a;this.options=this.sandbox.util.extend({},d,this.options),this.items={},this.rowCount=0,this.table=null,this.isEmpty=this.items.length,a=this.sandbox.dom.data(this.$el,"items"),0===this.options.data.length&&a&&a.length>0&&(this.options.data=a),u.call(this),this.render(),j.call(this),k.call(this),s.call(this)},render:function(){var b=this.sandbox.util.extend({},{addText:this.sandbox.translate("salescore.item.add"),isEditable:this.options.isEditable,canAddRemove:this.options.canAddRemove},this.options.data);this.table=this.sandbox.util.template(a,b),this.html(this.table),r.call(this),q.call(this,this.options.data),v.call(this)},getItems:function(){var a,b=[];for(a in this.items)this.items.hasOwnProperty(a)&&b.push(this.items[a]);return b}}});